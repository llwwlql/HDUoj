<html><head><meta http-equiv="Pragma" content="no-cache"><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="Content-Language" content="en-US"><title>3330 -- Dr. Podboq or: How We Became Asymmetric</title><link rel=stylesheet href='poj.css' type='text/css'><link rel='shortcut icon' href='poj.ico'><link rel='icon' href='poj.gif' type='image/gif'><script src='poj.js' language='javascript'></script></head><body lang="en-US" leftmargin=5 link=blue alink=blue vlink=blue onkeydown=KeyDown(event)><a name=top></a><TABLE style='BORDER-COLLAPSE: collapse' borderColor=#ffffff width=100% border=1><TBODY><TR><TD align=CENTER colSpan=5><table class=h1 cellpadding=0><tr><td width=25% align=left><img src='images/logo1.jpg' height=100 border=0></td><td colspan=3 bgcolor='#EAEFFD'><table class=h2><tr><td><img border=0 src='images/logo0.gif' width=450 height=90></td><td width=95><img border=0 src='images/logo3.gif' width=95 height=95></td></tr></table></td></tr></table></TD></TR><TR vAlign=top align=CENTER bgColor=#6589d1><TH class=h>Online Judge</TH><TH class=h>Problem Set</TH><TH class=h>Authors</TH><TH class=h>Online Contests</TH><TH class=h>User</TH></TR><TR vAlign=top align=CENTER bgColor='#f1f1fd'><TD class='h' onMouseOver='scbg(this, 1)' onMouseOut='scbg(this, 0)'><A href='bbs'>Web Board</A><BR><A href='./'>Home Page</A><BR><A href='page?id=1000' target=_blank>F.A.Qs</A><BR><a href='chart'>Statistical Charts</a></TD><TD class='h' onMouseOver='scbg(this, 1)' onMouseOut='scbg(this, 0)'><FORM action=gotoproblem method=get><A href='problemlist'>Problems</A><BR><A href='submit'>Submit Problem</A><BR><A href='status'>Online Status</A><BR><font color=blue>Prob.ID:</font><input type=text name=pid size=6><input type=Submit value=Go name=pb1></form></td><TD class='h' onMouseOver='scbg(this,1)' onMouseOut='scbg(this,0)'><form method=GET action=searchuser><a href=register>Register</a><br><a href=modifyuser>Update your info</a><br><a href=userlist>Authors ranklist</a><br><input type=text name=key size=10><input type=Submit value=Search name=B1></form></TD>
<TD class=h onMouseOver='scbg(this,1)' onMouseOut='scbg(this,0)'><font color=#1a5cc8>Current Contest</font><br><a href=pastcontests>Past Contests</a><br><a href=contests>Scheduled Contests</a><br><a href=challenge.html target=_blank><font color=red>Award Contest</font></a></td><TD align=left class=h onMouseOver='scbg(this,1)' onMouseOut='scbg(this,0)'><form method=POST action=login><table><tr><td>User ID:</td><td><input type=text name=user_id1 size=10 style='font-family:monospace'></td></tr><tr><td>Password:</td><td><input type=password name=password1 size=10 style='font-family:monospace'></td></tr></table><input type=Submit value=login name=B1>&nbsp;&nbsp;<a href=register target=_parent>Register</a><input type=hidden name=url value=/problem?id=3330></form></td></TR></TABLE><table border=0 width=100% background=images/table_back.jpg><tr><td>
<div style='position: absolute; right: 10px;'>Language:<select size=1 onChange="window.location.href='problem?id=3330&lang='+this.value+'&change=true'"><option value='default' selected>Default</option></select></div><div class="ptt" lang="en-US">Dr. Podboq or: How We Became Asymmetric</div>
<div class="plm"><table align="center"><tr><td><b>Time Limit:</b> 2000MS</td><td width="10px"></td><td><b>Memory Limit:</b> 65536K</td></tr><tr><td><b>Total Submissions:</b> 329</td><td width="10px"></td><td><b>Accepted:</b> 109</td></table></div><p class="pst">Description</p><div class="ptx" lang="en-US"><div>After long studying how embryos of organisms become asymmetric during their development, Dr. Podboq, a famous biologist, has reached his new hypothesis. Dr. Podboq is now preparing a poster for the coming academic conference, which shows a tree representing the development process of an embryo through repeated cell divisions starting from one cell. Your job is to write a program that transforms given trees into forms satisfying some conditions so that it is easier for the audience to get the idea. <!-- end en only --><!-- begin en only --><p>A tree representing the process of cell divisions has a form described below. </p><ul><li>The starting cell is represented by a circle placed at the top. </li><li>Each cell either terminates the division activity or divides into two cells. Therefore, from each circle representing a cell, there are either no branch downward, or two branches down to its two child cells. </li></ul>Below is an example of such a tree.<!-- end en only --><center><img class="center" src="images/3330_1.png" border="1"><br><!-- begin en only -->Figure F-1: A tree representing a process of cell divisions <!-- end en only --></center><!-- begin en only --><p>According to Dr. Podboq's hypothesis, we can determine which cells have stronger or weaker asymmetricity by looking at the structure of this tree representation. First, his hypothesis defines &quot;left-right similarity&quot; of cells as follows: </p><ol><li>The left-right similarity of a cell that did not divide further is 0. </li><li>For a cell that did divide further, we collect the partial trees starting from its child or descendant cells, and count how many kinds of structures they have. Then, the left-right similarity of the cell is defined to be the ratio of the number of structures that appear both in the right child side and the left child side. We regard two trees have the same structure if we can make them have exactly the same shape by interchanging two child cells of <del>arbitrary</del> <ins>some</ins> cells. </li></ol>For example, suppose we have a tree shown below: <!-- end en only --><center><img class="center" src="images/3330_2.png" border="1"><br><!-- begin en only -->Figure F-2: An example tree <!-- end en only --></center><!-- begin en only --><p>The left-right similarity of the cell A is computed as follows. First, within the descendants of the cell B, which is the left child cell of A, the following three kinds of structures appear. Notice that the rightmost structure appears three times, but when we count the number of structures, we count it only once. </p><!-- end en only --><center><img class="center" src="images/3330_3.png" border="1"><br><!-- begin en only -->Figure F-3: Structures appearing within the descendants of the cell B <!-- end en only --></center><!-- begin en only --><p>On the other hand, within the descendants of the cell C, which is the right child cell of A, the following four kinds of structures appear. </p><!-- end en only --><center><img class="center" src="images/3330_4.png" border="1"><br><!-- begin en only -->Figure F-4: Structures appearing within the descendants of the cell C <!-- end en only --></center><!-- begin en only --><p>Among them, the first, second, and third ones within the B side are regarded as the same structure as the second, third, and fourth ones within the C side, respectively. Therefore, there are four structures in total, and three among them are common to the left side and the right side, which means the left-right similarity of A is 3/4. </p><!-- end en only --><!-- begin en only --><p>Given the left-right similarity of each cell, Dr. Podboq's hypothesis says we can determine which of the cells <i>X</i> and <i>Y</i> has stronger asymmetricity by the following rules. </p><ol><li>If <i>X</i> and <i>Y</i> have different left-right similarities, the one with lower left-right similarity has stronger asymmetricity. </li><li>Otherwise, if neither <i>X</i> nor <i>Y</i> has child cells, they have completely equal asymmetricity. </li><li>Otherwise, both <i>X</i> and <i>Y</i> must have two child cells. In this case, we compare the child cell of <i>X</i> with stronger (or equal) asymmetricity (than the other child cell of <i>X</i>) and the child cell of <i>Y</i> with stronger (or equal) asymmetricity (than the other child cell of <i>Y</i>), and the one having a child with stronger asymmetricity has stronger asymmetricity. </li><li>If we still have a tie, we compare the other child cells of <i>X</i> and <i>Y</i> with weaker (or equal) asymmetricity, and the one having a child with stronger asymmetricity has stronger asymmetricity. </li><li>If we still have a tie again, <i>X</i> and <i>Y</i> have completely equal asymmetricity. </li></ol>When we compare child cells in some rules above, we recursively apply this rule set.<!-- end en only --><!-- begin en only --><p>Now, your job is to write a program that transforms a given tree representing a process of cell divisions, by interchanging two child cells of arbitrary cells, into a tree where the following conditions are satisfied. </p><ol><li>For every cell <i>X</i> which is the starting cell of the given tree or a left child cell of some parent cell, if <i>X</i> has two child cells, the one at left has stronger (or equal) asymmetricity than the one at right. </li><li>For every cell <i>X</i> which is a right child cell of some parent cell, if <i>X</i> has two child cells, the one at right has stronger (or equal) asymmetricity than the one at left. </li></ol>In case two child cells have equal asymmetricity, their order is arbitrary because either order would results in trees of the same shape. <!-- end en only --><!-- begin en only --><p>For example, suppose we are given the tree in Figure F-2. First we compare B and C, and because B has lower left-right similarity, which means stronger asymmetricity, we keep B at left and C at right. Next, because B is the left child cell of A, we compare two child cells of B, and the one with stronger asymmetricity is positioned at left. On the other hand, because C is the right child cell of A, we compare two child cells of C, and the one with stronger asymmetricity is positioned at right. We examine the other cells in the same way, and the tree is finally transformed into the tree shown below. </p><!-- end en only --><center><img class="center" src="images/3330_5.png" border="1"><br><!-- begin en only -->Figure F-5: The example tree after the transformation <!-- end en only --></center><!-- begin en only --><p>Please be warned that the only operation allowed in the transformation of a tree is to interchange two child cells of some parent cell. For example, you are not allowed to transform the tree in Figure F-2 into the tree below. </p><!-- end en only --><center><img class="center" src="images/3330_6.png" border="1"><br><!-- begin en only -->Figure F-6: An example of disallowed transformation <!-- end en only --></center></div></div><p class="pst">Input</p><div class="ptx" lang="en-US"><div><!-- begin en only --><p>The input consists of <i>n</i> lines (1≤<i>n</i>≤100) describing <i>n</i> trees followed by a line only containing a single zero which represents the end of the input. Each tree includes at least 1 and at most 127 cells. Below is an example of a tree description. </p><!-- end en only --><blockquote><tt>((x (x x)) x)</tt> </blockquote><!-- begin en only --><p>This description represents the tree shown in Figure F-1. More formally, the description of a tree is in either of the following two formats. </p><blockquote>&quot;<tt>(</tt>&quot; &lt;description of a tree starting at the left child&gt; &lt;single space&gt; &lt;description of a tree starting at the right child&gt; &quot;)&quot; </blockquote>or <blockquote>&quot;<tt>x</tt>&quot; </blockquote>The former is the description of a tree whose starting cell has two child cells, and the latter is the description of a tree whose starting cell has no child cell. </div></div><p class="pst">Output</p><div class="ptx" lang="en-US"><div><!-- begin en only --><p>For each tree given in the input, print a line describing the result of the tree transformation. In the output, trees should be described in the same formats as the input, and the tree descriptions must appear in the same order as the input. Each line should have no extra character other than one tree description. </div></div><p class="pst">Sample Input</p><pre class="sio"><pre>(((x x) x) ((x x) (x (x x))))
(((x x) (x x)) ((x x) ((x x) (x x))))
(((x x) ((x x) x)) (((x (x x)) x) (x x)))
(((x x) x) ((x x) (((((x x) x) x) x) x)))
(((x x) x) ((x (x x)) (x (x x))))
((((x (x x)) x) (x ((x x) x))) ((x (x x)) (x x)))
((((x x) x) ((x x) (x (x x)))) (((x x) (x x)) ((x x) ((x x) (x x)))))
0</pre></pre><p class="pst">Sample Output</p><pre class="sio"><pre>((x (x x)) ((x x) ((x x) x)))
(((x x) ((x x) (x x))) ((x x) (x x)))
(((x ((x x) x)) (x x)) ((x x) ((x x) x)))
(((x ((x ((x x) x)) x)) (x x)) ((x x) x))
((x (x x)) ((x (x x)) ((x x) x)))
(((x (x x)) (x x)) ((x ((x x) x)) ((x (x x)) x)))
(((x (x x)) ((x x) ((x x) x))) (((x x) (x x)) (((x x) (x x)) (x x))))</pre></pre><p class="pst">Source</p><div class="ptx" lang="en-US"><a href="searchproblem?field=source&key=Japan+2007+Domestic">Japan 2007 Domestic</a></div></td></tr></table>
<font color=#333399 size=3><p align="center">
[<a href="submit?problem_id=3330">Submit</a>]&nbsp;&nbsp;
 [<a href="javascript:history.go(-1)">Go Back</a>]&nbsp;&nbsp; [<a href=problemstatus?problem_id=3330>Status</a>]&nbsp;&nbsp; 
[<a href="bbs?problem_id=3330">Discuss</a>]
</font></p>
<p><img height=30 src=images/home.gif width=40 border=0><font size=3><a href=.>Home Page</a> </font>&nbsp;&nbsp;<img height=30 src='images/goback.gif' width=40 border=0><font size=3><a href='javascript:history.go(-1)'>Go Back</a>&nbsp;&nbsp;<img height=30 width=40 border=0 src='images/top.gif'><a href=#top>To top</a></font><br><hr><P align=center style='font-family:Arial, Helvetica, sans-serif'>All Rights Reserved 2003-2013 Ying Fuchen,Xu Pengcheng,Xie Di<br>Any problem, Please <a href=mailto:webmaster@poj.org>Contact Administrator</a></p><script type="text/javascript"> var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-790353-1']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script></body></html>
