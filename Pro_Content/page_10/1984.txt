<html><head><meta http-equiv="Pragma" content="no-cache"><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="Content-Language" content="en-US"><title>1984 -- Navigation Nightmare</title><link rel=stylesheet href='poj.css' type='text/css'><link rel='shortcut icon' href='poj.ico'><link rel='icon' href='poj.gif' type='image/gif'><script src='poj.js' language='javascript'></script></head><body lang="en-US" leftmargin=5 link=blue alink=blue vlink=blue onkeydown=KeyDown(event)><a name=top></a><TABLE style='BORDER-COLLAPSE: collapse' borderColor=#ffffff width=100% border=1><TBODY><TR><TD align=CENTER colSpan=5><table class=h1 cellpadding=0><tr><td width=25% align=left><img src='images/logo1.jpg' height=100 border=0></td><td colspan=3 bgcolor='#EAEFFD'><table class=h2><tr><td><img border=0 src='images/logo0.gif' width=450 height=90></td><td width=95><img border=0 src='images/logo3.gif' width=95 height=95></td></tr></table></td></tr></table></TD></TR><TR vAlign=top align=CENTER bgColor=#6589d1><TH class=h>Online Judge</TH><TH class=h>Problem Set</TH><TH class=h>Authors</TH><TH class=h>Online Contests</TH><TH class=h>User</TH></TR><TR vAlign=top align=CENTER bgColor='#f1f1fd'><TD class='h' onMouseOver='scbg(this, 1)' onMouseOut='scbg(this, 0)'><A href='bbs'>Web Board</A><BR><A href='./'>Home Page</A><BR><A href='page?id=1000' target=_blank>F.A.Qs</A><BR><a href='chart'>Statistical Charts</a></TD><TD class='h' onMouseOver='scbg(this, 1)' onMouseOut='scbg(this, 0)'><FORM action=gotoproblem method=get><A href='problemlist'>Problems</A><BR><A href='submit'>Submit Problem</A><BR><A href='status'>Online Status</A><BR><font color=blue>Prob.ID:</font><input type=text name=pid size=6><input type=Submit value=Go name=pb1></form></td><TD class='h' onMouseOver='scbg(this,1)' onMouseOut='scbg(this,0)'><form method=GET action=searchuser><a href=register>Register</a><br><a href=modifyuser>Update your info</a><br><a href=userlist>Authors ranklist</a><br><input type=text name=key size=10><input type=Submit value=Search name=B1></form></TD>
<TD class=h onMouseOver='scbg(this,1)' onMouseOut='scbg(this,0)'><font color=#1a5cc8>Current Contest</font><br><a href=pastcontests>Past Contests</a><br><a href=contests>Scheduled Contests</a><br><a href=challenge.html target=_blank><font color=red>Award Contest</font></a></td><TD align=left class=h onMouseOver='scbg(this,1)' onMouseOut='scbg(this,0)'><form method=POST action=login><table><tr><td>User ID:</td><td><input type=text name=user_id1 size=10 style='font-family:monospace'></td></tr><tr><td>Password:</td><td><input type=password name=password1 size=10 style='font-family:monospace'></td></tr></table><input type=Submit value=login name=B1>&nbsp;&nbsp;<a href=register target=_parent>Register</a><input type=hidden name=url value=/problem?id=1984></form></td></TR></TABLE><table border=0 width=100% background=images/table_back.jpg><tr><td>
<div style='position: absolute; right: 10px;'>Language:<select size=1 onChange="window.location.href='problem?id=1984&lang='+this.value+'&change=true'"><option value='default' selected>Default</option></select></div><div class="ptt" lang="en-US">Navigation Nightmare</div>
<div class="plm"><table align="center"><tr><td><b>Time Limit:</b> 2000MS</td><td width="10px"></td><td><b>Memory Limit:</b> 30000K</td></tr><tr><td><b>Total Submissions:</b> 6216</td><td width="10px"></td><td><b>Accepted:</b> 2229</td></tr><tr><td colspan="3" align="center" style="color:#0ead00"><b>Case Time Limit:</b> 1000MS</td></tr></table></div><p class="pst">Description</p><div class="ptx" lang="en-US">Farmer John's pastoral neighborhood has N farms (2 <= N <= 40,000), usually numbered/labeled 1..N.  A series of M (1 <= M < 40,000) vertical and horizontal roads each of varying lengths (1 <= length <= 1000) connect the farms.  A map of these farms might look something like the illustration below in which farms are labeled F1..F7 for clarity and lengths between connected farms are shown as (n):<br><pre>           F1 --- (13) ---- F6 --- (9) ----- F3<br>            |                                 |<br>           (3)                                |<br>            |                                (7)<br>           F4 --- (20) -------- F2            |<br>            |                                 |<br>           (2)                               F5<br>            | <br>           F7 </pre><br>Being an ASCII diagram, it is not precisely to scale, of course.<br><br>Each farm can connect directly to at most four other farms via roads that lead exactly north, south, east, and/or west.  Moreover, farms are only located at the endpoints of roads, and some farm can be found at every endpoint of every road.  No two roads cross, and precisely one path <br>(sequence of roads) links every pair of farms.<br><br>FJ lost his paper copy of the farm map and he wants to reconstruct it from backup information on his computer.  This data contains lines like the following, one for every road:<br><br>   There is a road of length 10 running north from Farm #23 to Farm #17<br>   There is a road of length 7 running east from Farm #1 to Farm #17<br>   ...<br><br>As FJ is retrieving this data, he is occasionally interrupted by questions such as the following that he receives from his navigationally-challenged neighbor, farmer Bob:<br><br>    What is the Manhattan distance between farms #1 and #23?<br><br>FJ answers Bob, when he can (sometimes he doesn't yet have enough data yet).  In the example above, the answer would be 17, since Bob wants to know the "Manhattan" distance between the pair of farms.<br>The Manhattan distance between two points (x1,y1) and (x2,y2) is just |x1-x2| + |y1-y2| (which is the distance a taxicab in a large city must travel over city streets in a perfect grid to connect two x,y points).<br><br>When Bob asks about a particular pair of farms, FJ might not yet have enough information to deduce the distance between them; in this case, FJ apologizes profusely and replies with "-1".<br></div><p class="pst">Input</p><div class="ptx" lang="en-US"><pre>* Line 1: Two space-separated integers: N and M<br><br>* Lines 2..M+1: Each line contains four space-separated entities, F1,<br>        F2, L, and D that describe a road. F1 and F2 are numbers of<br>        two farms connected by a road, L is its length, and D is a<br>        character that is either 'N', 'E', 'S', or 'W' giving the<br>        direction of the road from F1 to F2.<br><br>* Line M+2: A single integer, K (1 <= K <= 10,000), the number of FB's<br>        queries<br><br>* Lines M+3..M+K+2: Each line corresponds to a query from Farmer Bob<br>        and contains three space-separated integers: F1, F2, and I. F1<br>        and F2 are numbers of the two farms in the query and I is the<br>        index (1 <= I <= M) in the data after which Bob asks the<br>        query. Data index 1 is on line 2 of the input data, and so on.</pre></div><p class="pst">Output</p><div class="ptx" lang="en-US"><pre>* Lines 1..K: One integer per line, the response to each of Bob's<br>        queries.  Each line should contain either a distance<br>        measurement or -1, if it is impossible to determine the<br>        appropriate distance.</pre></div><p class="pst">Sample Input</p><pre class="sio">7 6
1 6 13 E
6 3 9 E
3 5 7 S
4 1 3 N
2 4 20 W
4 7 2 S
3
1 6 1
1 4 3
2 6 6
</pre><p class="pst">Sample Output</p><pre class="sio">13
-1
10
</pre><p class="pst">Hint</p><div class="ptx" lang="en-US">At time 1, FJ knows the distance between 1 and 6 is 13.<br>At time 3, the distance between 1 and 4 is still unknown.<br>At the end, location 6 is 3 units west and 7 north of 2, so the distance is 10.<br></div><p class="pst">Source</p><div class="ptx" lang="en-US"><a href="searchproblem?field=source&key=USACO+2004+February">USACO 2004 February</a></div></td></tr></table>
<font color=#333399 size=3><p align="center">
[<a href="submit?problem_id=1984">Submit</a>]&nbsp;&nbsp;
 [<a href="javascript:history.go(-1)">Go Back</a>]&nbsp;&nbsp; [<a href=problemstatus?problem_id=1984>Status</a>]&nbsp;&nbsp; 
[<a href="bbs?problem_id=1984">Discuss</a>]
</font></p>
<p><img height=30 src=images/home.gif width=40 border=0><font size=3><a href=.>Home Page</a> </font>&nbsp;&nbsp;<img height=30 src='images/goback.gif' width=40 border=0><font size=3><a href='javascript:history.go(-1)'>Go Back</a>&nbsp;&nbsp;<img height=30 width=40 border=0 src='images/top.gif'><a href=#top>To top</a></font><br><hr><P align=center style='font-family:Arial, Helvetica, sans-serif'>All Rights Reserved 2003-2013 Ying Fuchen,Xu Pengcheng,Xie Di<br>Any problem, Please <a href=mailto:webmaster@poj.org>Contact Administrator</a></p><script type="text/javascript"> var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-790353-1']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script></body></html>
