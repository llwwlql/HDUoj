<html><head><meta http-equiv="Pragma" content="no-cache"><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="Content-Language" content="en-US"><title>3807 -- Chemist’s Math</title><link rel=stylesheet href='poj.css' type='text/css'><link rel='shortcut icon' href='poj.ico'><link rel='icon' href='poj.gif' type='image/gif'><script src='poj.js' language='javascript'></script></head><body lang="en-US" leftmargin=5 link=blue alink=blue vlink=blue onkeydown=KeyDown(event)><a name=top></a><TABLE style='BORDER-COLLAPSE: collapse' borderColor=#ffffff width=100% border=1><TBODY><TR><TD align=CENTER colSpan=5><table class=h1 cellpadding=0><tr><td width=25% align=left><img src='images/logo1.jpg' height=100 border=0></td><td colspan=3 bgcolor='#EAEFFD'><table class=h2><tr><td><img border=0 src='images/logo0.gif' width=450 height=90></td><td width=95><img border=0 src='images/logo3.gif' width=95 height=95></td></tr></table></td></tr></table></TD></TR><TR vAlign=top align=CENTER bgColor=#6589d1><TH class=h>Online Judge</TH><TH class=h>Problem Set</TH><TH class=h>Authors</TH><TH class=h>Online Contests</TH><TH class=h>User</TH></TR><TR vAlign=top align=CENTER bgColor='#f1f1fd'><TD class='h' onMouseOver='scbg(this, 1)' onMouseOut='scbg(this, 0)'><A href='bbs'>Web Board</A><BR><A href='./'>Home Page</A><BR><A href='page?id=1000' target=_blank>F.A.Qs</A><BR><a href='chart'>Statistical Charts</a></TD><TD class='h' onMouseOver='scbg(this, 1)' onMouseOut='scbg(this, 0)'><FORM action=gotoproblem method=get><A href='problemlist'>Problems</A><BR><A href='submit'>Submit Problem</A><BR><A href='status'>Online Status</A><BR><font color=blue>Prob.ID:</font><input type=text name=pid size=6><input type=Submit value=Go name=pb1></form></td><TD class='h' onMouseOver='scbg(this,1)' onMouseOut='scbg(this,0)'><form method=GET action=searchuser><a href=register>Register</a><br><a href=modifyuser>Update your info</a><br><a href=userlist>Authors ranklist</a><br><input type=text name=key size=10><input type=Submit value=Search name=B1></form></TD>
<TD class=h onMouseOver='scbg(this,1)' onMouseOut='scbg(this,0)'><font color=#1a5cc8>Current Contest</font><br><a href=pastcontests>Past Contests</a><br><a href=contests>Scheduled Contests</a><br><a href=challenge.html target=_blank><font color=red>Award Contest</font></a></td><TD align=left class=h onMouseOver='scbg(this,1)' onMouseOut='scbg(this,0)'><form method=POST action=login><table><tr><td>User ID:</td><td><input type=text name=user_id1 size=10 style='font-family:monospace'></td></tr><tr><td>Password:</td><td><input type=password name=password1 size=10 style='font-family:monospace'></td></tr></table><input type=Submit value=login name=B1>&nbsp;&nbsp;<a href=register target=_parent>Register</a><input type=hidden name=url value=/problem?id=3807></form></td></TR></TABLE><table border=0 width=100% background=images/table_back.jpg><tr><td>
<div style='position: absolute; right: 10px;'>Language:<select size=1 onChange="window.location.href='problem?id=3807&lang='+this.value+'&change=true'"><option value='default' selected>Default</option></select></div><div class="ptt" lang="en-US">Chemist’s Math</div>
<div class="plm"><table align="center"><tr><td><b>Time Limit:</b> 1000MS</td><td width="10px"></td><td><b>Memory Limit:</b> 65536K</td></tr><tr><td><b>Total Submissions:</b> 82</td><td width="10px"></td><td><b>Accepted:</b> 31</td></table></div><p class="pst">Description</p><div class="ptx" lang="en-US">You have probably learnt chemical equations (chemical reaction formulae) in your high-school days. The following are some well-known equations.<br><center><br>2H<sub>2</sub> + O<sub>2</sub> -> 2H<sub>2</sub>O (1)<br>Ca(OH)<sub>2</sub> + CO<sub>2</sub> -> CaCO<sub>3</sub> + H<sub>2</sub>O (2)<br>N<sub>2</sub> + 3H<sub>2</sub> -> 2NH<sub>3</sub> (3)<br></center><br>While Equations (1)–(3) all have balanced left-hand sides and right-hand sides, the following ones do not.<br><center><br>Al + O<sub>2</sub> -> Al<sub>2</sub>O<sub>3</sub> (wrong) (4)<br>C<sub>3</sub>H<sub>8</sub> + O<sub>2</sub> -> CO<sub>2</sub> + H<sub>2</sub>O (wrong) (5)<br></center><br>The equations must follow the law of conservation of mass; the quantity of each chemical element (such as H, O, Ca, Al) should not change with chemical reactions. So we should “adjust” the numbers of molecules on the left-hand side and right-hand side:<br><center><br>4Al + 3O<sub>2</sub> -> 2Al<sub>2</sub>O<sub>3</sub> (correct) (6)<br>C<sub>3</sub>H<sub>8</sub> + 5O<sub>2</sub> -> 3CO<sub>2</sub> + 4H<sub>2</sub>O (correct) (7)<br></center><br>The coeﬃcients of Equation (6) are (4, 3, 2) from left to right, and those of Equation (7) are (1, 5, 3, 4) from left to right. Note that the coeﬃcient 1 may be omitted from chemical equations.<br><br>The coeﬃcients of a correct equation must satisfy the following conditions.<br><br>1. The coeﬃcients are all positive integers.<br>2. The coeﬃcients are relatively prime, that is, their greatest common divisor (g.c.d.) is 1.<br>3. The quantities of each chemical element on the left-hand side and the right-hand side are equal.<br><br>Conversely, if a chemical equation satisﬁes the above three conditions, we regard it as a correct equation, no matter whether the reaction or its constituent molecules can be chemically realized in the real world, and no matter whether it can be called a reaction (e.g., H<sub>2</sub> -> H<sub>2</sub> is considered correct). A chemical equation satisfying Conditions 1 and 3 (but not necessarily Condition 2) is called a balanced equation.<br><br>Your goal is to read in chemical equations with missing coeﬃcients like Equation (4) and (5), line by line, and output the sequences of coeﬃcients that make the equations correct. Note that the above three conditions do not guarantee that a correct equation is uniquely determined. For example, if we “mix” the reactions generating H<sub>2</sub>O and NH<sub>3</sub>, we would get<br><center><br>xH<sub>2</sub> + yO<sub>2</sub> + zN<sub>2</sub> + uH<sub>2</sub> -> vH<sub>2</sub>O + wNH<sub>3</sub> (8)<br></center><br>but (x, y, z, u, v, w) = (2, 1, 1, 3, 2, 2) does not represent a unique correct equation; for instance, (4, 2, 1, 3, 4, 2) and (4, 2, 3, 9, 4, 6) are also “correct” according to the above deﬁnition! However, we guarantee that every chemical equation we give you will lead to a unique correct equation by adjusting their coeﬃcients. In other words, we guarantee that (i) every chemical equation can be balanced with positive coeﬃcients, and that (ii) all balanced equations of the original equation can be obtained by multiplying the coeﬃcients of a unique correct equation by a positive integer.</div><p class="pst">Input</p><div class="ptx" lang="en-US">The input is a sequence of chemical equations (without coeﬃcients) of the following syntax in the Backus-Naur Form:<br><br>&ltchemical_equation&gt ::= &ltmolecule_sequence&gt "->" &ltmolecule_sequence&gt<br>&ltmolecule_sequence&gt ::= &ltmolecule&gt | &ltmolecule&gt "+" &ltmolecule_sequence&gt<br>&ltmolecule&gt ::= &ltgroup&gt | &ltgroup&gt &ltmolecule&gt<br>&ltgroup&gt ::= &ltunit_group&gt | &ltunit_group&gt &ltnumber&gt<br>&ltunit_group&gt ::= &ltchemical_element&gt | "(" &ltmolecule&gt ")"<br>&ltchemical_element&gt ::= &ltuppercase_letter&gt | &ltuppercase_letter&gt &ltlowercase_letter&gt<br>&ltuppercase_letter&gt ::= "A" | "B" | "C" | "D" | "E" | "F" | "G" | "H" | "I" | "J" | "K" | "L" | "M" | "N" | "O" | "P" | "Q" | "R" | "S" | "T" | "U" | "V" | "W" | "X" | "Y" | "Z"<br>&ltlowercase_letter&gt ::= "a" | "b" | "c" | "d" | "e" | "f" | "g" | "h" | "i" | "j" | "k" | "l" | "m" | "n" | "o" | "p" | "q" | "r" | "s" | "t" | "u" | "v" | "w" | "x" | "y" | "z"<br>&ltnumber&gt ::= &ltnon_zero_digit&gt | &ltnon_zero_digit&gt &ltdigit&gt<br>&ltnon_zero_digit&gt ::= "1" | "2" | "3" | "4" | "5" | "6" | "7" | "8" | "9"<br>&ltdigit> ::= "0" | &ltnon_zero_digit&gt<br><br>Each chemical equation is followed by a period and a newline. No other characters such as spaces do not appear in the input. For instance, the equation<br><br>Ca(OH)<sub>2</sub> + CO<sub>2</sub> -> CaCO<sub>3</sub> + H<sub>2</sub>O<br><br>is represented as<br><br>Ca(OH)2+CO2->CaCO3+H2O.<br><br>Each chemical equation is no more than 80 characters long, and as the above syntax implies, the <number>’s are less than 100. Parentheses may be used but will not be nested (maybe a good news to some of you!). Each side of a chemical equation consists of no more than 10 top-level molecules. The coeﬃcients that make the equations correct will not exceed 40000. The chemical equations in the input have been chosen so that 32-bit integer arithmetic would suﬃce with appropriate precautions against possible arithmetic overﬂow. You are free to use 64-bit arithmetic, however.<br><br>The end of the input is indicated by a line consisting of a single period.<br><br>Note that our deﬁnition of &ltchemical_element&gt above allows chemical elements that do not exist or unknown as of now, and excludes known chemical elements with three-letter names (e.g., ununbium (Uub), with the atomic number 112).</div><p class="pst">Output</p><div class="ptx" lang="en-US">For each chemical equation, output a line containing the sequence of positive integer coeﬃcients that make the chemical equation correct. Numbers in a line must be separated by a single space. No extra characters should appear in the output.</div><p class="pst">Sample Input</p><pre class="sio">N2+H2->NH3.
Na+Cl2->NaCl.
Ca(OH)2+CO2->CaCO3+H2O.
CaCl2+AgNO3->Ca(NO3)2+AgCl.
C2H5OH+O2->CO2+H2O.
C4H10+O2->CO2+H2O.
A12B23+C34D45+ABCD->A6D7+B8C9.
A98B+B98C+C98->A98B99C99.
A2+B3+C5+D7+E11+F13->ABCDEF.
.</pre><p class="pst">Sample Output</p><pre class="sio">1 3 2
2 1 2
1 1 1 1
1 2 1 2
1 3 2 3
2 13 8 10
2 123 33042 5511 4136
1 1 1 1
15015 10010 6006 4290 2730 2310 30030</pre><p class="pst">Source</p><div class="ptx" lang="en-US"><a href="searchproblem?field=source&key=Tokyo+2009">Tokyo 2009</a></div></td></tr></table>
<font color=#333399 size=3><p align="center">
[<a href="submit?problem_id=3807">Submit</a>]&nbsp;&nbsp;
 [<a href="javascript:history.go(-1)">Go Back</a>]&nbsp;&nbsp; [<a href=problemstatus?problem_id=3807>Status</a>]&nbsp;&nbsp; 
[<a href="bbs?problem_id=3807">Discuss</a>]
</font></p>
<p><img height=30 src=images/home.gif width=40 border=0><font size=3><a href=.>Home Page</a> </font>&nbsp;&nbsp;<img height=30 src='images/goback.gif' width=40 border=0><font size=3><a href='javascript:history.go(-1)'>Go Back</a>&nbsp;&nbsp;<img height=30 width=40 border=0 src='images/top.gif'><a href=#top>To top</a></font><br><hr><P align=center style='font-family:Arial, Helvetica, sans-serif'>All Rights Reserved 2003-2013 Ying Fuchen,Xu Pengcheng,Xie Di<br>Any problem, Please <a href=mailto:webmaster@poj.org>Contact Administrator</a></p><script type="text/javascript"> var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-790353-1']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script></body></html>
