<html><head><meta http-equiv="Pragma" content="no-cache"><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="Content-Language" content="en-US"><title>3202 -- A Very Simple Compiler</title><link rel=stylesheet href='poj.css' type='text/css'><link rel='shortcut icon' href='poj.ico'><link rel='icon' href='poj.gif' type='image/gif'><script src='poj.js' language='javascript'></script></head><body lang="en-US" leftmargin=5 link=blue alink=blue vlink=blue onkeydown=KeyDown(event)><a name=top></a><TABLE style='BORDER-COLLAPSE: collapse' borderColor=#ffffff width=100% border=1><TBODY><TR><TD align=CENTER colSpan=5><table class=h1 cellpadding=0><tr><td width=25% align=left><img src='images/logo1.jpg' height=100 border=0></td><td colspan=3 bgcolor='#EAEFFD'><table class=h2><tr><td><img border=0 src='images/logo0.gif' width=450 height=90></td><td width=95><img border=0 src='images/logo3.gif' width=95 height=95></td></tr></table></td></tr></table></TD></TR><TR vAlign=top align=CENTER bgColor=#6589d1><TH class=h>Online Judge</TH><TH class=h>Problem Set</TH><TH class=h>Authors</TH><TH class=h>Online Contests</TH><TH class=h>User</TH></TR><TR vAlign=top align=CENTER bgColor='#f1f1fd'><TD class='h' onMouseOver='scbg(this, 1)' onMouseOut='scbg(this, 0)'><A href='bbs'>Web Board</A><BR><A href='./'>Home Page</A><BR><A href='page?id=1000' target=_blank>F.A.Qs</A><BR><a href='chart'>Statistical Charts</a></TD><TD class='h' onMouseOver='scbg(this, 1)' onMouseOut='scbg(this, 0)'><FORM action=gotoproblem method=get><A href='problemlist'>Problems</A><BR><A href='submit'>Submit Problem</A><BR><A href='status'>Online Status</A><BR><font color=blue>Prob.ID:</font><input type=text name=pid size=6><input type=Submit value=Go name=pb1></form></td><TD class='h' onMouseOver='scbg(this,1)' onMouseOut='scbg(this,0)'><form method=GET action=searchuser><a href=register>Register</a><br><a href=modifyuser>Update your info</a><br><a href=userlist>Authors ranklist</a><br><input type=text name=key size=10><input type=Submit value=Search name=B1></form></TD>
<TD class=h onMouseOver='scbg(this,1)' onMouseOut='scbg(this,0)'><font color=#1a5cc8>Current Contest</font><br><a href=pastcontests>Past Contests</a><br><a href=contests>Scheduled Contests</a><br><a href=challenge.html target=_blank><font color=red>Award Contest</font></a></td><TD align=left class=h onMouseOver='scbg(this,1)' onMouseOut='scbg(this,0)'><form method=POST action=login><table><tr><td>User ID:</td><td><input type=text name=user_id1 size=10 style='font-family:monospace'></td></tr><tr><td>Password:</td><td><input type=password name=password1 size=10 style='font-family:monospace'></td></tr></table><input type=Submit value=login name=B1>&nbsp;&nbsp;<a href=register target=_parent>Register</a><input type=hidden name=url value=/problem?id=3202></form></td></TR></TABLE><table border=0 width=100% background=images/table_back.jpg><tr><td>
<div style='position: absolute; right: 10px;'>Language:<select size=1 onChange="window.location.href='problem?id=3202&lang='+this.value+'&change=true'"><option value='default' selected>Default</option></select></div><div class="ptt" lang="en-US">A Very Simple Compiler</div>
<div class="plm"><table align="center"><tr><td><b>Time Limit:</b> 5000MS</td><td width="10px"></td><td><b>Memory Limit:</b> 131072K</td></tr><tr><td><b>Total Submissions:</b> 45</td><td width="10px"></td><td><b>Accepted:</b> 2</td></tr><tr><td style="color:#0ead00"><b>Case Time Limit:</b> 2000MS</td><td width="10px"></td><td style="font-weight:bold; color:red;">Special Judge</td></tr></table></div><p class="pst">Description</p><div class="ptx" lang="en-US"><span lang="en-us"><p>A typical assignment for computer science students is to build a compiler that compiles a simple language for a RISC architecture, which, when it goes to extremes, could become: evaluating an expression on an ultimate RISC architecture &ndash; a One Instruction Set Computer (OISC).</p><p><b>Target Architecture</b></p><p>The target architecture has a memory consisting of 65,536 16-bit words and a 16-bit instruction pointer IP. As suggested by its name, it has only one instruction: subtract-and-branch-if-non-negative. In each instruction cycle, the processor reads three consecutive words <i>a</i>, <i>b</i> and <i>c</i> at the address stored in IP, then subtracts <i>a</i> from the word at address <i>b</i>. If the result is non-negative, IP is set to <i>c</i>, otherwise it is increased by three. (Here by &ldquo;subtract&rdquo; and &ldquo;non-negative&rdquo; we mean 16-bit signed integer arithmetic.) When IP is greater than or equal to 65,534, the processor halts.</p><p>A program is executed as follows:</p><ol><li>The program is loaded into memory starting from address 0.</li><li>A word-sized input parameter is placed at address 0, overwriting the program&rsquo;s first word.</li><li>IP is set to 0.</li><li>The processor starts execution until it halts.</li><li>The word at address 0 is considered as the output.</li></ol><p><b>Source Language</b></p><p>The source language is an arithmetic expression consisting of only &lsquo;<code>(</code>&rsquo;, &lsquo;<code>)</code>&rsquo;, &lsquo;<code>+</code>&rsquo;, &lsquo;<code>*</code>&rsquo;, &lsquo;<code>x</code>&rsquo; and floating-point constants. &lsquo;<code>x</code>&rsquo; represents the input. The expression is supposed to be evaluated in exactly the same manner as its literally specified semantics, i.e., subexpressions in parentheses take highest precedence, followed by multiplication then addition. All constants, intermediate results and the input &lsquo;<code>x</code>&rsquo; are rounded to 16-bit half-precision floating point numbers by the round-to-even method. </p><p>Given an expression, your task is to compile it into an OISC program.</p><hr align="left" width="400" size="1"><p><b>A quick reference for half-precision floating point</b> </p><p><i>Memory format</i></p><blockquote><p>Half precision memory format has a sign bit, 5 bits of exponent and 10 bits of mantissa:</p><table border="1" cellpadding="2" cellspacing="0" style="border-collapse: collapse" bordercolor=#000000><tr><td rowspan="2" valign="top" width="25"><p align="center">bit</p></td><td width="30">15</td><td width="60">14~10</td><td width="60">9~0</td></tr><tr><td width="30">sign</td><td width="60">exponent</td><td width="60">mantissa</td></tr></table><p>The mathematical value of a half-precision floating point number is (&minus;1)<sup>sign</sup> &times; <span style="text-decoration: overline">1.mantissa</span> &times; 2<sup>exponent &minus; 15</sup>. Below are several examples.</p><table border="1" cellpadding="2" cellspacing="0" style="border-collapse: collapse" bordercolor=#000000><tr><td>Encoding</td><td>Value</td></tr><tr><td>0 01111 000000000</td><td>1</td></tr><tr><td>0 01111 100000000</td><td>1.5</td></tr><tr><td>1 01110 100000000</td><td>&minus;0.75</td></tr></table><p>Among all possible exponents, 0 and 31 are reserved for representation of special values and not involved in this problem.</p></blockquote><p><i>Rounding convention</i></p><blockquote><p>Rounding is done by the round-to-even method, i.e., an unrepresentable value is rounded to the nearest number unless two possible outcomes are equally near, in which case the one with an even least significant bit is chosen. Below are several examples.</p><table border="1" cellpadding="2" cellspacing="0" style="border-collapse: collapse" bordercolor=#000000><tr><td>Decimal</td><td>Binary</td><td>Rounded in half precision</td><td>Rounded in binary</td></tr><tr><td>0.499755859375</td><td>0.0111111111111</td><td>0 01110 0000000000</td><td>0.1</td></tr><tr><td>2.0009765625</td><td>10.0000000001</td><td>0 10000 0000000000</td><td>10</td></tr><tr><td>0.6</td><td>0.10011001&hellip;</td><td>0 01110 0011001101</td><td>0.10011001101</td></tr></table></blockquote><p>Below are two routines written in C for simplified conversions between half-precision and single-precision floating point numbers.</p><p><code>typedef unsigned short half;<br><br>float half_to_float(half h)<br>{<br>&nbsp;&nbsp;&nbsp; unsigned int f;<br>&nbsp;&nbsp;&nbsp; if ((h &amp; 0x7ffff) == 0) return 0;<br>&nbsp;&nbsp;&nbsp; f = ((h &amp; 0x8000) &lt;&lt; 16) /* sign&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; */<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + ((h &amp; 0x7fff) &lt;&lt; 13) /* exponent and mantissa */<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; + ((127 - 15) &lt;&lt; 23);&nbsp; /* adjust exponent&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; */<br>&nbsp;&nbsp;&nbsp; return *(float*)&amp;f;<br>}<br><br>half float_to_half(float f)<br>{<br>&nbsp;&nbsp;&nbsp; unsigned int u = *(unsigned int*)&amp;f;<br>&nbsp;&nbsp;&nbsp; int e = ((u &gt;&gt; 23) &amp; 0xff) - 127 + 15;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* exponent&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; */<br>&nbsp;&nbsp;&nbsp; int m = ((u &gt;&gt; 13) &amp; 0x3ff) + ((u &gt;&gt; 12) &amp; 1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* mantissa rounded half-up */<br>&nbsp;&nbsp;&nbsp; if ((u &amp; 0x1fff) == 0x1000) m &amp;= 0x7fe;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* round to even&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; */<br>&nbsp;&nbsp;&nbsp; if (m == 0x400) { m = 0; e++; }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* carry&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; */<br>&nbsp;&nbsp;&nbsp; if (e &lt;= 0) { return (u &gt;&gt; 16) &amp; 0x8000; }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* underflow or zero&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; */<br>&nbsp;&nbsp;&nbsp; if (e &gt; 30) { return 0x7bff + ((u &gt;&gt; 16) &amp; 0x8000); } /* overflow&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; */<br>&nbsp;&nbsp;&nbsp; return ((u &gt;&gt; 16) &amp; 0x8000) + (e &lt;&lt; 10) + m;<br>}</code></p></span></div><p class="pst">Input</p><div class="ptx" lang="en-US"><p>The input is presented as an expression on a single line. The expression can contain up to 8 arithmetic operators.</p></div><p class="pst">Output</p><div class="ptx" lang="en-US"><p>The output should be a line of at most 65,536 space-separated integers, each representing a word in the OISC program starting from address 0. Memory unoccupied when the program is loaded will be filled with 0.</p></div><p class="pst">Sample Input</p><pre class="sio">0.499755859375+0.125*(2.0009765625+2)</pre><p class="pst">Sample Output</p><pre class="sio">0 0 3 -15360 0 65535</pre><p class="pst">Hint</p><div class="ptx" lang="en-US"><p>Underflow, overflow and special values (zeroes, denormals, infinities and NaNs) will not occur in this problem.</p><p>Rounding to single precision before rounding to half precision is always safe in this problem.</p></div><p class="pst">Source</p><div class="ptx" lang="en-US"><a href="searchproblem?field=source&key=POJ+Monthly--2007.03.04">POJ Monthly--2007.03.04</a>, Hou, Qiming</div></td></tr></table>
<font color=#333399 size=3><p align="center">
[<a href="submit?problem_id=3202">Submit</a>]&nbsp;&nbsp;
 [<a href="javascript:history.go(-1)">Go Back</a>]&nbsp;&nbsp; [<a href=problemstatus?problem_id=3202>Status</a>]&nbsp;&nbsp; 
[<a href="bbs?problem_id=3202">Discuss</a>]
</font></p>
<p><img height=30 src=images/home.gif width=40 border=0><font size=3><a href=.>Home Page</a> </font>&nbsp;&nbsp;<img height=30 src='images/goback.gif' width=40 border=0><font size=3><a href='javascript:history.go(-1)'>Go Back</a>&nbsp;&nbsp;<img height=30 width=40 border=0 src='images/top.gif'><a href=#top>To top</a></font><br><hr><P align=center style='font-family:Arial, Helvetica, sans-serif'>All Rights Reserved 2003-2013 Ying Fuchen,Xu Pengcheng,Xie Di<br>Any problem, Please <a href=mailto:webmaster@poj.org>Contact Administrator</a></p><script type="text/javascript"> var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-790353-1']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script></body></html>
